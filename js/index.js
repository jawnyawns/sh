!function(){"use strict";function n(){const n=window.matchMedia("(min-aspect-ratio: 1/1) and (min-width: 800px)").matches?64:0;return[Math.min(window.innerWidth,window.innerHeight)-2*n,window.innerHeight-2*n]}function t(){o().forEach(r),i().forEach(u),c().forEach(u)}function e(n){o().forEach(u),i().forEach(r),c().forEach(u),document.querySelector(".game-score").textContent=n}function o(){return[document.querySelector(".home-title"),document.querySelector(".home-hint")]}function i(){return[document.querySelector(".game-score")]}function c(){return[document.querySelector(".game-over-title"),document.querySelector(".game-over-result"),document.querySelector(".game-over-hint")]}function u(n){n.style.visibility="hidden"}function r(n){n.style.visibility="visible"}const a="9px sans-serif",f="#0f0",s=1e3/29,[m,g]=n(),p=360,l=p*(g/m),h=l/2+69;function d(n,t=n=>{}){return Array.from({length:n},((n,e)=>t(e)))}function w(n,t,e,o,i){const c=function(n,t,e){return Math.max(Math.min(n,e),t)}(n,t,e);return function(n,t,e,o,i){return(n-t)*(i-o)/(e-t)+o}(c,t,e,o,i)}function M(n){return Math.random()<n}function y(n,t){return Math.random()*(t-n)+n}function v(n,t,e,o,i=1/0){return function(n,t,e=1/0,o=()=>{}){for(let o=0;o<e;o++){const e=n();if(t(e))return e}return o()}((()=>function(n,t,e){return d(e,(()=>y(n,t)))}(n,t,e)),(n=>n.sort().every(((t,e)=>0===e||t-n[e-1]>=o))),i,(()=>null))}function x(){return M(.5)}function T(n){return n[(t=0,e=n.length,Math.floor(Math.random()*(e-t))+t)];var t,e}function S(n){const t=y(0,n.reduce(((n,t)=>n+t),0));let e=0;for(let o=0;o<n.length;o++)if(e+=n[o],t<e)return o}function A(n,t){return n[S(t)]}function E(n,t){return n.x<t.x+t.width&&n.y<t.y+t.height&&t.x<n.x+n.width&&t.y<n.y+n.height}function R(n){return-n.width<n.x&&n.x<p}function X(n,t){return t/n}function b(n,t,e,o){return n+t*o+.5*e*o*o}function j(n,t,e){return n+t*e}function k(n){return new Promise(((t,e)=>{const o=new Image;o.onload=()=>t(o),o.onerror=n=>e(n),o.src=n}))}async function I(n,t){const e=await fetch(t),o=await e.arrayBuffer();return await n.decodeAudioData(o)}function _(n,t){if("running"===n.state){const e=n.createBufferSource();e.buffer=t,e.connect(n.destination),e.start()}}function F(n,t,e,o,i,c,u=1,r=1,a=0){n.save(),n.translate(e+.5*i,o+.5*c),n.scale(u,r),n.rotate(a),n.drawImage(t,.5*-i,.5*-c,i,c),n.restore()}const G="high-score";const Y=20,C=20,L=Math.floor(p/2)-Y/2,O=h-C,B=-.75,N=112,P=B*B/(2*N),V=2*Math.abs(B)/P,q=2.5,D=2.5,J=.75,U=.9*B,z=.35,$=250,H=3e3,K=180;function Q(){return{t:0,o:q,i:D,u:0,width:Y,height:C,x:L,y:3.5*-C,velocityY:0,m:!0,p:0}}function W(n){return n.l.y<=O}function Z(n){n.status!==Bn||n.l.m||(n.l.velocityY=B,n.l.t=1,n.l.m=!0,n.l.p=n.h,_(n.M,T(n.T.v)))}function nn(n){n.status===On||n.status===Bn?(n.l.m&&(tn(n),function(n){(function(n){return n.l.y>O})(n)&&(n.l.y=O,n.l.velocityY=0,n.l.m=!1,n.l.S=!1,n.l.t=0,n.l.u=0)}(n),function(n){n.l.S&&!n.l.m&&Z(n)}(n)),function(n){if(!n.l.m){const o=n.A.filter((n=>!n.R));if(o.length>0){const i=(t=o,e=n.l.x,function(n,t=n=>n){return n.reduce(((n,e)=>t(e)<t(n)?e:n))}(t,(n=>Math.abs(n.x-e)))),c=n.l.o<0!==i.X;n.l.o*=c?-1:1}}var t,e}(n)):n.status===Nn&&tn(n)}function tn(n){var t,e,o;n.l.velocityY=(t=n.l.velocityY,e=P,o=n.j,t+e*o),n.l.y=b(n.l.y,n.l.velocityY,P,n.j);n.l.velocityY/B<z&&(n.l.t=2)}function en(n){const t=y($,H);n.k=setTimeout((()=>{n.l.m||(n.l.t=3),n.k=setTimeout((()=>{n.l.m||(n.l.t=0),en(n)}),K)}),t)}function on(n){n.l.velocityY=U,n.l.t=1,function(n){clearTimeout(n.k)}(n)}const cn=1.5*Y,un=cn/4,rn="rgba(0, 0, 0, 0.12)",an=.5;function fn(n){if(W(n)){const t=1-an,e=1-function(n){const t=O,e=O-N;return w(n.l.y,e,t,1,0)}(n)*t;n._.I=e,n._.F=e}}function sn(n){W(n)&&(n.G.fillStyle=rn,function(n,t,e,o,i,c=1,u=1,r=0){n.save(),n.translate(t,e),n.scale(c,u),n.beginPath(),n.ellipse(0,0,.5*o,.5*i,r,0,2*Math.PI),n.fill(),n.restore()}(n.G,n._.x,n._.y,n._.width,n._.height,n._.I,n._.F))}const mn=10,gn=10,pn=h-C/2-gn/2,ln=2,hn=2,dn=.4,wn=mn*ln*.5,Mn=[{t:0,velocityX:.13},{t:1,velocityX:.17},{t:2,velocityX:.22}],yn=[.4,.4,.2],vn=Math.min(...function(n,t,e){const o=.5*e,i=t,c=i*i-4*o*-n;if(c<0)return null;{const n=Math.sqrt(c);return[(-i+n)/(2*o),(-i-n)/(2*o)]}}(pn-(O+C),B,P)),xn=L/.13,Tn=50,Sn=.8,An=.25;function En(n){const t=function(n){function t(n){return n<5?[.1,.3,.6]:n<24?[.45,.4,.15]:n<46?[.65,.3,.05]:[.9,.1,0]}const e=[1*V,2.5*V,3.5*V],o=[2.5*V,3.5*V,7*V],i=S(t(n));return y(e[i],o[i])}(n.Y);n.C=setTimeout((()=>{if(n.status!==Bn)return;const t=n.h+xn;var e;const o=function(n){const t=x(),e=A(Mn,yn).velocityX;return d(n,(()=>{const o=M(Math.pow(Sn,1/n))?t:!t,i=M(Math.pow(An,1/n))?e:A(Mn,yn).velocityX;return o?i:-i}))}((e=n.Y)<5?1+S([.9,.1]):e<11?1+S([.7,.2,.05,.05]):e<29?1+S([.5,.2,.1,.1]):1+S([.4,.2,.15,.15,.05,.05])),i=o.reduce(((n,t)=>{const e=n.get(t)??0;return n.set(t,e+1),n}),new Map);const c=function(n,t=(n,t)=>[n,t]){return new Map(Array.from(n,(([n,e])=>t(n,e))))}(new Map(o.map((n=>[n,Rn(t,n)]))),((n,[t,e])=>[n,function(n,t,e,o){const i=10;for(let c=0;c<e;c++){const u=v(n,t,e-c,o,i);if(u)return u}}(t,e,i.get(n),mn*ln/Math.abs(n))])),u=Array.from(c,(([n,t])=>t.map((t=>function(n,t){const e=Mn.find((n=>Math.abs(t)===n.velocityX)).t,o=t>=0,i=X(wn,t)*dn;return{L:n,t:e,o:ln,i:hn,u:0,O:i,width:mn,height:gn,x:o?-mn:p,y:pn,velocityX:t,X:o,R:!1}}(t,n))))).flat();n.B.push(t),n.N.push(...u),En(n)}),t)}function Rn(n,t){const e=Tn+s,o=n+V-vn-e,i=L+Y+mn;return[n+vn+e-L/Math.abs(t),o-i/Math.abs(t)]}const Xn=10,bn=10,jn=h-C/2-bn/2,kn=.095,In=2.67,_n=2.67,Fn=.4*X(Xn*In*.5,kn),Gn=2e3,Yn=25e3;function Cn(){return function(n){return{o:In,i:_n,u:0,O:n?Fn:-Fn,width:Xn,height:bn,x:n?-Xn:p,y:jn,velocityX:n?kn:-kn,X:n,R:!1}}(x())}function Ln(n){const t=y(Gn,Yn);n.P=setTimeout((()=>{if(n.status!==Bn)return;const t=Cn();n.V.push(t),Ln(n)}),t)}const On="GAME_NOT_STARTED",Bn="GAME_IN_PROGRESS",Nn="GAME_OVER",Pn="GAME_RESETTABLE",Vn=250;function qn(n){for(let t=n.q;t>0;t-=s)n.j=Math.min(t,s),n.h+=n.j,Dn(n),n.D+=1;n.J+=1,n.U-n.$>=1e3&&(n.H=n.J,n.K=n.D,n.J=0,n.D=0,n.$=n.U),function(n){(function(n){n.G.clearRect(0,0,p,l)})(n),sn(n),function(n){F(n.G,n.images.l[n.l.t],n.l.x,n.l.y,n.l.width,n.l.height,n.l.o,n.l.i,n.l.u),n.W&&(n.G.strokeStyle=f,n.G.strokeRect(n.l.x,n.l.y,Y,C))}(n),function(n){for(const t of n.V)F(n.G,n.images.Z,t.x,t.y,t.width,t.height,t.o,t.i,t.u),n.W&&(n.G.strokeStyle=f,n.G.strokeRect(t.x,t.y,t.width,t.height))}(n),function(n){for(const t of n.A)F(n.G,n.images.nn[t.t],t.x,t.y,t.width,t.height,t.o,t.i,t.u),n.W&&(n.G.strokeStyle=f,n.G.strokeRect(t.x,t.y,mn,gn))}(n),function(n){n.tn>0&&(n.G.fillStyle=`rgba(255, 255, 255, ${n.tn})`,n.G.fillRect(0,0,p,l))}(n),function(n){if(n.W){const t=[performance.memory&&(performance.memory.usedJSHeapSize/1024/1024).toFixed(1)+" MB",Math.round(n.H)+" F/S",Math.round(n.K)+" U/S"].filter(Boolean).join("   ");n.G.font=a,n.G.fillStyle=f,n.G.fillText(t,8,l-8),n.G.strokeStyle=f,n.G.strokeRect(0,0,p,p)}}(n)}(n),requestAnimationFrame((t=>{n.q=t-n.U,n.U=t,qn(n)}))}function Dn(n){!function(n){const t=n.B.length>0&&n.B[0]<=n.h;n.en&&t&&(Z(n),n.B.shift())}(n),nn(n),function(n){const t=n.N.filter((t=>t.L<=n.h));n.N=n.N.filter((t=>t.L>n.h)),n.A.push(...t),t.length>0&&_(n.M,n.T.cn)}(n),function(n){for(const t of n.A)t.x=b(t.x,t.velocityX,0,n.j),t.u=j(t.u,t.O,n.j)}(n),function(n){for(const t of n.V)t.x=b(t.x,t.velocityX,0,n.j),t.u=j(t.u,t.O,n.j)}(n),function(n){if(n.status!==Bn)return;const t=n.A.filter((n=>{const t=!n.R,e=n.X&&n.x>L+Y,o=!n.X&&n.x+mn<L;return t&&(e||o)}));t.forEach((n=>n.R=!0)),n.Y+=t.length,t.length>0&&(_(n.M,T(n.T.Y)),e(n.Y))}(n),function(n){if(n.status!==Bn)return;const t=n.V.filter((t=>{const e=!t.R,o=E(n.l,t);return e&&o}));t.forEach((n=>n.R=!0)),n.Y+=t.length,n.V=n.V.filter((n=>!t.includes(n))),t.length>0&&(_(n.M,n.T.un),e(n.Y))}(n),function(n){n.status===Bn?function(n){for(const t of n.A)if(E(n.l,t))return!0;return!1}(n)&&(!function(n){n.Y>n.rn&&(n.rn=n.Y,t=n.Y,localStorage.setItem(G,t));var t}(n),function(n){clearTimeout(n.P)}(n),function(n){clearTimeout(n.C)}(n),function(n){n.tn=1}(n),on(n),n.status=Nn,_(n.M,n.T.an)):n.status===Nn&&function(n){return 0===n.A.length&&0===n.V.length}(n)&&(n.status=Pn,t=n.Y,e=n.rn,o().forEach(u),i().forEach(u),c().forEach(r),document.querySelector(".game-over-score").textContent=t,document.querySelector(".game-over-high-score").textContent=e);var t,e}(n),function(n){n.A=n.A.filter(R)}(n),function(n){n.V=n.V.filter(R)}(n),function(n){n.tn>0&&(n.tn-=n.j/Vn,n.tn<0&&(n.tn=0))}(n),fn(n)}async function Jn(n){await async function(n){"suspended"===n.M.state&&await n.M.resume()}(n),function(n){n.status===On&&function(n){return n.l.y===O}(n)?(n.status=Bn,Ln(n),En(n),e(n.Y)):n.status===Pn&&(n.status=On,n.l=Q(),n.Y=0,en(n),t())}(n),Z(n),function(n){const t=n.h-n.l.p;n.status===Bn&&t>V*J&&(n.l.S=!0)}(n)}function Un(t,e){const[o,i]=n(),c=Math.floor(o*window.devicePixelRatio),u=Math.floor(i*window.devicePixelRatio),r=c/p;t.style.width=o+"px",t.style.height=i+"px",t.width=Math.floor(c),t.height=Math.floor(u),t.getContext("2d").scale(r,r),e.style.width=t.style.width}!async function(){const n=document.querySelector(".background"),e=document.querySelector(".canvas"),o=e.getContext("2d");Un(e,n);const i=new AudioContext,c={v:[],Y:[]},u=[I(i,"./sfx/die.mp3").then((n=>c.an=n)),I(i,"./sfx/eat.wav").then((n=>c.un=n)),I(i,"./sfx/jump-0.mp3").then((n=>c.v[0]=n)),I(i,"./sfx/jump-1.mp3").then((n=>c.v[1]=n)),I(i,"./sfx/jump-2.mp3").then((n=>c.v[2]=n)),I(i,"./sfx/jump-3.mp3").then((n=>c.v[3]=n)),I(i,"./sfx/jump-4.mp3").then((n=>c.v[4]=n)),I(i,"./sfx/jump-5.mp3").then((n=>c.v[5]=n)),I(i,"./sfx/score-0.wav").then((n=>c.Y[0]=n)),I(i,"./sfx/score-1.wav").then((n=>c.Y[1]=n)),I(i,"./sfx/score-2.wav").then((n=>c.Y[2]=n)),I(i,"./sfx/score-3.wav").then((n=>c.Y[3]=n)),I(i,"./sfx/shoot.wav").then((n=>c.cn=n))],r={l:[],nn:[]},a=[k("./img/player-0.png").then((n=>r.l[0]=n)),k("./img/player-1.png").then((n=>r.l[1]=n)),k("./img/player-2.png").then((n=>r.l[2]=n)),k("./img/player-3.png").then((n=>r.l[3]=n)),k("./img/enemy-0.png").then((n=>r.nn[0]=n)),k("./img/enemy-1.png").then((n=>r.nn[1]=n)),k("./img/enemy-2.png").then((n=>r.nn[2]=n)),k("./img/snack.png").then((n=>r.Z=n))];await Promise.all([...u,...a]);const f=new URL(location),s="true"===f.searchParams.get("auto"),m="true"===f.searchParams.get("debug"),g=Number.parseInt(f.searchParams.get("score"))||0,l=localStorage.getItem(G)??0,d=function(n,t,e,o,i,c,u,r){return{G:n,M:t,T:e,images:o,U:0,q:0,h:0,j:0,status:On,Y:r,rn:i,l:Q(),_:{width:cn,height:un,x:Math.floor(p/2),y:h-1.5,I:0,F:0},A:[],N:[],V:[],B:[],en:c,W:u,H:0,J:0,K:0,D:0,$:0,P:null,C:null,k:null,tn:0}}(o,i,c,r,l,s,m,g);requestAnimationFrame((n=>{d.q=0,d.U=n,en(d),qn(d)})),window.addEventListener("resize",(()=>Un(e,n)),{passive:!0}),document.addEventListener("pointerup",(async n=>{n.stopPropagation(),await Jn(d),document.addEventListener("pointerdown",(async n=>{n.stopPropagation(),await Jn(d)}),{passive:!0})}),{once:!0,passive:!0});let w=!1;document.addEventListener("keydown",(async n=>{n.stopPropagation()," "!==n.key||w||(await Jn(d),w=!0)}),{passive:!0}),document.addEventListener("keyup",(()=>{w=!1})),t()}()}();
