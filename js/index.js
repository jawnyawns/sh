!function(){"use strict";const n="9px sans-serif",t="#0f0",e=1e3/29,o=360,i=360,c=.69*i;function u(n,t=n=>{}){return Array.from({length:n},((n,e)=>t(e)))}function r(n,t,e,o,i){const c=function(n,t,e){return Math.max(Math.min(n,e),t)}(n,t,e);return function(n,t,e,o,i){return(n-t)*(i-o)/(e-t)+o}(c,t,e,o,i)}function a(n){return Math.random()<n}function f(n,t){return Math.random()*(t-n)+n}function s(n,t,e,o,i=1/0){return function(n,t,e=1/0,o=()=>{}){for(let o=0;o<e;o++){const e=n();if(t(e))return e}return o()}((()=>function(n,t,e){return u(e,(()=>f(n,t)))}(n,t,e)),(n=>n.sort().every(((t,e)=>0===e||t-n[e-1]>=o))),i,(()=>null))}function m(){return a(.5)}function g(n){return n[(t=0,e=n.length,Math.floor(Math.random()*(e-t))+t)];var t,e}function p(n){const t=f(0,n.reduce(((n,t)=>n+t),0));let e=0;for(let o=0;o<n.length;o++)if(e+=n[o],t<e)return o}function l(n,t){return n[p(t)]}function d(n,t){return n.x<t.x+t.width&&n.y<t.y+t.height&&t.x<n.x+n.width&&t.y<n.y+n.height}function h(n){return-n.width<n.x&&n.x<o}function w(n,t){return t/n}function y(n,t,e,o){return n+t*o+.5*e*o*o}function M(n,t,e){return n+t*e}function v(n){return new Promise(((t,e)=>{const o=new Image;o.onload=()=>t(o),o.onerror=n=>e(n),o.src=n}))}async function x(n,t){const e=await fetch(t),o=await e.arrayBuffer();return await n.decodeAudioData(o)}function T(n,t){if("running"===n.state){const e=n.createBufferSource();e.buffer=t,e.connect(n.destination),e.start()}}function S(n,t,e,o,i,c,u=1,r=1,a=0){n.save(),n.translate(e+.5*i,o+.5*c),n.scale(u,r),n.rotate(a),n.drawImage(t,.5*-i,.5*-c,i,c),n.restore()}const A="high-score";function E(){X().forEach(I),b().forEach(k),j().forEach(k)}function R(n){X().forEach(k),b().forEach(I),j().forEach(k),document.querySelector(".game-score").textContent=n}function X(){return[document.querySelector(".home-title"),document.querySelector(".home-hint")]}function b(){return[document.querySelector(".game-score")]}function j(){return[document.querySelector(".game-over-title"),document.querySelector(".game-over-result"),document.querySelector(".game-over-hint")]}function k(n){n.style.visibility="hidden"}function I(n){n.style.visibility="visible"}const $=20,_=20,F=Math.floor(o/2)-$/2,G=c-_,Y=-.75,C=.31*i,L=Y*Y/(2*C),O=2*Math.abs(Y)/L,B=2.5,N=2.5,P=.9*Y,V=.35,q=250,D=3e3,U=180;function z(){return{t:0,o:B,i:N,u:0,width:$,height:_,x:F,y:3.5*-_,velocityY:0,m:!0}}function J(n){return n.p.y<=G}function H(n){n.status!==Gn||n.p.m||(n.p.velocityY=Y,n.p.t=1,n.p.m=!0,T(n.l,g(n.M.h)))}function K(n){n.status===Fn||n.status===Gn?(n.p.m&&(Q(n),function(n){(function(n){return n.p.y>G})(n)&&(n.p.y=G,n.p.velocityY=0,n.p.m=!1,n.p.t=0,n.p.u=0)}(n)),function(n){if(!n.p.m){const o=n.v.filter((n=>!n.T));if(o.length>0){const i=(t=o,e=n.p.x,function(n,t=n=>n){return n.reduce(((n,e)=>t(e)<t(n)?e:n))}(t,(n=>Math.abs(n.x-e)))),c=n.p.o<0!==i.S;n.p.o*=c?-1:1}}var t,e}(n)):n.status===Yn&&Q(n)}function Q(n){var t,e,o;n.p.velocityY=(t=n.p.velocityY,e=L,o=n.A,t+e*o),n.p.y=y(n.p.y,n.p.velocityY,L,n.A);n.p.velocityY/Y<V&&(n.p.t=2)}function W(n){const t=f(q,D);n.R=setTimeout((()=>{n.p.m||(n.p.t=3),n.R=setTimeout((()=>{n.p.m||(n.p.t=0),W(n)}),U)}),t)}function Z(n){n.p.velocityY=P,n.p.t=1,function(n){clearTimeout(n.R)}(n)}const nn=1.5*$,tn=nn/4,en="rgba(0, 0, 0, 0.12)",on=.5;function cn(n){if(J(n)){const t=1-on,e=1-function(n){const t=G,e=G-C;return r(n.p.y,e,t,1,0)}(n)*t;n.j.X=e,n.j.k=e}}function un(n){J(n)&&(n.I.fillStyle=en,function(n,t,e,o,i,c=1,u=1,r=0){n.save(),n.translate(t,e),n.scale(c,u),n.beginPath(),n.ellipse(0,0,.5*o,.5*i,r,0,2*Math.PI),n.fill(),n.restore()}(n.I,n.j.x,n.j.y,n.j.width,n.j.height,n.j.X,n.j.k))}const rn=10,an=10,fn=c-_/2-an/2,sn=2,mn=2,gn=.4,pn=rn*sn*.5,ln=[{t:0,velocityX:.13},{t:1,velocityX:.17},{t:2,velocityX:.22}],dn=[.4,.4,.2],hn=Math.min(...function(n,t,e){const o=.5*e,i=t,c=i*i-4*o*-n;{const n=Math.sqrt(c);return[(-i+n)/(2*o),(-i-n)/(2*o)]}}(fn-(G+_),Y,L)),wn=F/.13,yn=50,Mn=.8,vn=.25;function xn(n){const t=function(n){function t(n){return n<10?[.1,.3,.6]:n<25?[.35,.5,.15]:n<50?[.5,.4,.1]:[.65,.3,.05]}const e=[1*O,2.5*O,3.5*O],o=[2.5*O,3.5*O,8*O],i=p(t(n));return f(e[i],o[i])}(n.$);n._=setTimeout((()=>{if(n.status!==Gn)return;const t=n.F+wn;var e;const i=function(n){const t=m(),e=l(ln,dn).velocityX;return u(n,(()=>{const o=a(Math.pow(Mn,1/n))?t:!t,i=a(Math.pow(vn,1/n))?e:l(ln,dn).velocityX;return o?i:-i}))}((e=n.$)<10?1+p([.9,.1]):e<25?1+p([.7,.2,.05,.05]):e<50?1+p([.5,.2,.1,.1]):1+p([.4,.2,.15,.15,.05,.05])),c=i.reduce(((n,t)=>{const e=n.get(t)??0;return n.set(t,e+1),n}),new Map);const r=function(n,t=(n,t)=>[n,t]){return new Map(Array.from(n,(([n,e])=>t(n,e))))}(new Map(i.map((n=>[n,Tn(t,n)]))),((n,[t,e])=>[n,function(n,t,e,o){const i=10;for(let c=0;c<e;c++){const u=s(n,t,e-c,o,i);if(u)return u}}(t,e,c.get(n),rn*sn/Math.abs(n))])),f=Array.from(r,(([n,t])=>t.map((t=>function(n,t){const e=ln.find((n=>Math.abs(t)===n.velocityX)).t,i=t>=0,c=w(pn,t)*gn;return{G:n,t:e,o:sn,i:mn,u:0,Y:c,width:rn,height:an,x:i?-rn:o,y:fn,velocityX:t,S:i,T:!1}}(t,n))))).flat();n.C.push(t),n.L.push(...f),xn(n)}),t)}function Tn(n,t){const o=yn+e,i=n+O-hn-o,c=F+$+rn;return[n+hn+o-F/Math.abs(t),i-c/Math.abs(t)]}const Sn=10,An=10,En=c-_/2-An/2,Rn=.095,Xn=2.67,bn=2.67,jn=.4*w(Sn*Xn*.5,Rn),kn=2e3,In=25e3;function $n(){return function(n){return{o:Xn,i:bn,u:0,Y:n?jn:-jn,width:Sn,height:An,x:n?-Sn:o,y:En,velocityX:n?Rn:-Rn,S:n,T:!1}}(m())}function _n(n){const t=f(kn,In);n.O=setTimeout((()=>{if(n.status!==Gn)return;const t=$n();n.B.push(t),_n(n)}),t)}const Fn="GAME_NOT_STARTED",Gn="GAME_IN_PROGRESS",Yn="GAME_OVER",Cn="GAME_RESETTABLE",Ln=250;function On(c){for(let n=c.N;n>0;n-=e)c.A=Math.min(n,e),c.F+=c.A,Bn(c),c.P+=1;c.V+=1,c.q-c.D>=1e3&&(c.U=c.V,c.J=c.P,c.V=0,c.P=0,c.D=c.q),function(e){(function(n){n.I.clearRect(0,0,o,i)})(e),un(e),function(n){S(n.I,n.images.p[n.p.t],n.p.x,n.p.y,n.p.width,n.p.height,n.p.o,n.p.i,n.p.u),n.H&&(n.I.strokeStyle=t,n.I.strokeRect(n.p.x,n.p.y,$,_))}(e),function(n){for(const e of n.B)S(n.I,n.images.K,e.x,e.y,e.width,e.height,e.o,e.i,e.u),n.H&&(n.I.strokeStyle=t,n.I.strokeRect(e.x,e.y,Sn,An))}(e),function(n){for(const e of n.v)S(n.I,n.images.W[e.t],e.x,e.y,e.width,e.height,e.o,e.i,e.u),n.H&&(n.I.strokeStyle=t,n.I.strokeRect(e.x,e.y,rn,an))}(e),function(n){n.Z>0&&(n.I.fillStyle=`rgba(255, 255, 255, ${n.Z})`,n.I.fillRect(0,0,o,i))}(e),function(e){if(e.H){const c=[performance.memory&&`${(performance.memory.usedJSHeapSize/1024/1024).toFixed(1)} MB`,`${Math.round(e.U)} F/S`,`${Math.round(e.J)} U/S`].filter(Boolean).join("   ");e.I.font=n,e.I.fillStyle=t,e.I.fillText(c,8,i-8),e.I.strokeStyle=t,e.I.strokeRect(0,0,o,o)}}(e)}(c),requestAnimationFrame((n=>{c.N=n-c.q,c.q=n,On(c)}))}function Bn(n){!function(n){const t=n.C.length>0&&n.C[0]<=n.F;n.nn&&t&&(H(n),n.C.shift())}(n),K(n),function(n){const t=n.L.filter((t=>t.G<=n.F));n.L=n.L.filter((t=>t.G>n.F)),n.v.push(...t),t.length>0&&T(n.l,n.M.tn)}(n),function(n){for(const t of n.v)t.x=y(t.x,t.velocityX,0,n.A),t.u=M(t.u,t.Y,n.A)}(n),function(n){for(const t of n.B)t.x=y(t.x,t.velocityX,0,n.A),t.u=M(t.u,t.Y,n.A)}(n),function(n){if(n.status!==Gn)return;const t=n.v.filter((n=>{const t=!n.T,e=n.S&&n.x>F+$,o=!n.S&&n.x+rn<F;return t&&(e||o)}));t.forEach((n=>n.T=!0)),n.$+=t.length,t.length>0&&(T(n.l,g(n.M.$)),R(n.$))}(n),function(n){if(n.status!==Gn)return;const t=n.B.filter((t=>{const e=!t.T,o=d(n.p,t);return e&&o}));t.forEach((n=>n.T=!0)),n.$+=t.length,n.B=n.B.filter((n=>!t.includes(n))),t.length>0&&(T(n.l,n.M.en),R(n.$))}(n),function(n){n.status===Gn?function(n){for(const t of n.v)if(d(n.p,t))return!0;return!1}(n)&&(!function(n){n.$>n.cn&&(n.cn=n.$,t=n.$,localStorage.setItem(A,t));var t}(n),function(n){clearTimeout(n.O)}(n),function(n){clearTimeout(n._)}(n),function(n){n.Z=1}(n),Z(n),n.status=Yn,T(n.l,n.M.un)):n.status===Yn&&function(n){return 0===n.v.length&&0===n.B.length}(n)&&(n.status=Cn,t=n.$,e=n.cn,X().forEach(k),b().forEach(k),j().forEach(I),document.querySelector(".game-over-score").textContent=t,document.querySelector(".game-over-high-score").textContent=e);var t,e}(n),function(n){n.v=n.v.filter(h)}(n),function(n){n.B=n.B.filter(h)}(n),function(n){n.Z>0&&(n.Z-=n.A/Ln,n.Z<0&&(n.Z=0))}(n),cn(n)}async function Nn(n){await async function(n){"suspended"===n.l.state&&await n.l.resume()}(n),function(n){n.status===Fn&&function(n){return n.p.y===G}(n)?(n.status=Gn,_n(n),xn(n),R(n.$)):n.status===Cn&&(n.status=Fn,n.p=z(),n.$=0,W(n),E())}(n),H(n)}function Pn(n,t){const e=window.matchMedia("(min-aspect-ratio: 1/1) and (min-width: 800px)").matches?64:0,c=Math.min(window.innerWidth,window.innerHeight)-2*e;n.style.width=`${c}px`,n.style.height=`${c}px`,n.width=Math.floor(c*window.devicePixelRatio),n.height=Math.floor(c*window.devicePixelRatio),n.getContext("2d").scale(n.width/o,n.height/i),t.style.width=n.style.width}!async function(){const n=document.querySelector(".background"),t=document.querySelector(".canvas"),e=t.getContext("2d");Pn(t,n);const i=new AudioContext,u={h:[],$:[]},r=[x(i,"./sfx/die.mp3").then((n=>u.un=n)),x(i,"./sfx/eat.wav").then((n=>u.en=n)),x(i,"./sfx/jump-0.mp3").then((n=>u.h[0]=n)),x(i,"./sfx/jump-1.mp3").then((n=>u.h[1]=n)),x(i,"./sfx/jump-2.mp3").then((n=>u.h[2]=n)),x(i,"./sfx/jump-3.mp3").then((n=>u.h[3]=n)),x(i,"./sfx/jump-4.mp3").then((n=>u.h[4]=n)),x(i,"./sfx/jump-5.mp3").then((n=>u.h[5]=n)),x(i,"./sfx/score-0.wav").then((n=>u.$[0]=n)),x(i,"./sfx/score-1.wav").then((n=>u.$[1]=n)),x(i,"./sfx/score-2.wav").then((n=>u.$[2]=n)),x(i,"./sfx/score-3.wav").then((n=>u.$[3]=n)),x(i,"./sfx/shoot.wav").then((n=>u.tn=n))],a={p:[],W:[]},f=[v("./img/player-0.png").then((n=>a.p[0]=n)),v("./img/player-1.png").then((n=>a.p[1]=n)),v("./img/player-2.png").then((n=>a.p[2]=n)),v("./img/player-3.png").then((n=>a.p[3]=n)),v("./img/enemy-0.png").then((n=>a.W[0]=n)),v("./img/enemy-1.png").then((n=>a.W[1]=n)),v("./img/enemy-2.png").then((n=>a.W[2]=n)),v("./img/snack.png").then((n=>a.K=n))];await Promise.all([...r,...f]);const s=new URL(location),m="true"===s.searchParams.get("auto"),g="true"===s.searchParams.get("debug"),p=Number.parseInt(s.searchParams.get("score"))||0,l=localStorage.getItem(A)??0,d=function(n,t,e,i,u,r,a,f){return{I:n,l:t,M:e,images:i,q:0,N:0,F:0,A:0,status:Fn,$:f,cn:u,p:z(),j:{width:nn,height:tn,x:Math.floor(o/2),y:c-1.5,X:0,k:0},v:[],L:[],B:[],C:[],nn:r,H:a,U:0,V:0,J:0,P:0,D:0,O:null,_:null,R:null,Z:0}}(e,i,u,a,l,m,g,p);requestAnimationFrame((n=>{d.N=0,d.q=n,W(d),On(d)})),window.addEventListener("resize",(()=>Pn(t,n)),{passive:!0}),document.addEventListener("pointerup",(async n=>{n.stopPropagation(),await Nn(d),document.addEventListener("pointerdown",(async n=>{n.stopPropagation(),await Nn(d),setTimeout((async()=>await Nn(d)),60),setTimeout((async()=>await Nn(d)),120)}),{passive:!0})}),{once:!0,passive:!0});let h=!1;document.addEventListener("keydown",(async n=>{n.stopPropagation()," "!==n.key||h||(await Nn(d),setTimeout((async()=>await Nn(d)),60),setTimeout((async()=>await Nn(d)),120),h=!0)}),{passive:!0}),document.addEventListener("keyup",(()=>{h=!1})),E()}()}();
