!function(){"use strict";const n="9px sans-serif",t="#0f0",e=1e3/29,o=360;function i(n){return n.height/2+69}function c(n,t=n=>{}){return Array.from({length:n},((n,e)=>t(e)))}function u(n){return Math.random()<n}function r(n,t){return Math.random()*(t-n)+n}function a(n,t,e,o,i=1/0){return function(n,t,e=1/0,o=()=>{}){for(let o=0;o<e;o++){const e=n();if(t(e))return e}return o()}((()=>function(n,t,e){return c(e,(()=>r(n,t)))}(n,t,e)),(n=>n.sort().every(((t,e)=>0===e||t-n[e-1]>=o))),i,(()=>null))}function f(){return u(.5)}function s(n){return n[(t=0,e=n.length,Math.floor(Math.random()*(e-t))+t)];var t,e}function m(n){const t=r(0,n.reduce(((n,t)=>n+t),0));let e=0;for(let o=0;o<n.length;o++)if(e+=n[o],t<e)return o}function g(n,t){return n[m(t)]}function d(n,t){return n.x<t.x+t.width&&n.y<t.y+t.height&&t.x<n.x+n.width&&t.y<n.y+n.height}function p(n){return-n.width<n.x&&n.x<o}function l(n,t){return t/n}function h(n,t,e,o){return n+t*o+.5*e*o*o}function w(n,t,e){return n+t*e}function y(n){return new Promise(((t,e)=>{const o=new Image;o.onload=()=>t(o),o.onerror=n=>e(n),o.src=n}))}async function v(n,t){const e=await fetch(t),o=await e.arrayBuffer();return await n.decodeAudioData(o)}function x(n,t){if("running"===n.state){const e=n.createBufferSource();e.buffer=t,e.connect(n.destination),e.start()}}function M(n,t,e,o,i,c,u=1,r=1,a=0){n.save(),n.translate(e+.5*i,o+.5*c),n.scale(u,r),n.rotate(a),n.drawImage(t,.5*-i,.5*-c,i,c),n.restore()}const T="high-score";function k(){A().forEach(X),E().forEach(R),I().forEach(R)}function S(n){A().forEach(R),E().forEach(X),I().forEach(R);const t=["./img/snack-0.png","./img/snack-1.png","./img/snack-2.png"][n.t];document.querySelector(".game-score").textContent=""+n.o,document.querySelector(".game-preferred-snack").style.backgroundImage=`url('${t}')`}function A(){return[document.querySelector(".home-title"),document.querySelector(".home-hint")]}function E(){return[document.querySelector(".game-score"),document.querySelector(".game-preferred-snack")]}function I(){return[document.querySelector(".game-over-title"),document.querySelector(".game-over-result"),document.querySelector(".game-over-hint")]}function R(n){n.style.visibility="hidden"}function X(n){n.style.visibility="visible"}const j=20,b=20,_=Math.floor(o/2)-j/2,C=-.75,F=C*C/224,G=2*Math.abs(C)/F,L=2.5,O=2.5,P=.7,Y=.9*C,B=.35,N=250,V=3e3,q=180;function D(){return{i:0,u:L,m:O,p:0,width:j,height:b,x:_,y:3.5*-b,velocityY:0,l:!0,h:0}}function J(n){return i(n)-b}function U(n){n.status!==An||n.v.l||(n.v.velocityY=C,n.v.i=1,n.v.l=!0,n.v.h=n.M,x(n.T,s(n.S.k)))}function $(n){n.status===Sn||n.status===An?(n.v.l&&(z(n),function(n){(function(n){return n.v.y>J(n)})(n)&&(n.v.y=J(n),n.v.velocityY=0,n.v.l=!1,n.v.i=0,n.v.p=0)}(n),function(n){n.v.A&&!n.v.l&&(U(n),n.v.A=!1)}(n)),function(n){if(!n.v.l){const o=n.I.filter((n=>!n.R));if(o.length>0){const i=(t=o,e=n.v.x,function(n,t=n=>n){return n.reduce(((n,e)=>t(e)<t(n)?e:n))}(t,(n=>Math.abs(n.x-e)))),c=n.v.u<0!==i.X;n.v.u*=c?-1:1}}var t,e}(n)):n.status===En&&z(n)}function z(n){var t,e,o;n.v.velocityY=(t=n.v.velocityY,e=F,o=n.j,t+e*o),n.v.y=h(n.v.y,n.v.velocityY,F,n.j);n.v.velocityY/C<B&&(n.v.i=2)}function H(n){const t=r(N,V);n._=setTimeout((()=>{n.v.l||(n.v.i=3),n._=setTimeout((()=>{n.v.l||(n.v.i=0),H(n)}),q)}),t)}function K(n){n.v.velocityY=Y,n.v.i=1,function(n){clearTimeout(n._)}(n)}const Q=10,W=10,Z=2.67,nn=2.67,tn=.4,en=Q*Z*.5,on=[{i:0,velocityX:.13},{i:1,velocityX:.17},{i:2,velocityX:.22}],cn=[.4,.4,.2],un=_/.13,rn=50,an=.8,fn=.25;function sn(n){return i(n)-b/2-W/2}function mn(n){return Math.min(...function(n,t,e){const o=.5*e,i=t,c=i*i-4*o*-n;if(c<0)return null;{const n=Math.sqrt(c);return[(-i+n)/(2*o),(-i-n)/(2*o)]}}(sn(n)-(J(n)+b),C,F))}function gn(n){const t=function(n){function t(n){return n<2?[.1,.3,.6]:n<6?[.45,.4,.15]:n<12?[.65,.3,.05]:[.9,.1,0]}const e=[1*G,2.5*G,3.5*G],o=[2.5*G,3.5*G,7*G],i=m(t(n));return u(.9)?r(e[i],o[i]):4*un}(n.o);n.C=setTimeout((()=>{if(n.status!==An)return;const t=n.M+un,e=(i=n.o)<2?1+m([.9,.1]):i<4?1+m([.7,.2,.05,.05]):i<10?1+m([.5,.2,.1,.1]):1+m([.4,.2,.15,.15,.05,.05]);var i;const r=function(n,t){const e=f(),o=on.toSpliced(n.t,1),i=cn.toSpliced(n.t,1),r=g(o,i).velocityX;return c(t,(()=>{const n=u(Math.pow(an,1/t))?e:!e,c=u(Math.pow(fn,1/t))?r:g(o,i).velocityX;return n?c:-c}))}(n,e),s=r.reduce(((n,t)=>{const e=n.get(t)??0;return n.set(t,e+1),n}),new Map);const d=function(n,t=(n,t)=>[n,t]){return new Map(Array.from(n,(([n,e])=>t(n,e))))}(new Map(r.map((e=>[e,dn(n,t,e)]))),((n,[t,e])=>[n,function(n,t,e,o){const i=10;for(let c=0;c<e;c++){const u=a(n,t,e-c,o,i);if(u)return u}}(t,e,s.get(n),Q*Z/Math.abs(n))])),p=Array.from(d,(([t,e])=>e.map((e=>function(n,t,e){const i=on.find((n=>Math.abs(e)===n.velocityX)).i,c=e>=0,u=l(en,e)*tn;return{F:t,i:i,u:Z,m:nn,p:0,G:u,width:Q,height:W,x:c?-Q:o,y:sn(n),velocityX:e,X:c,R:!1}}(n,e,t))))).flat();n.L.push(t),n.O.push(...p),gn(n)}),t)}function dn(n,t,o){const i=rn+e,c=mn(n),u=t+G-c-i,r=_+j+Q;return[t+c+i-_/Math.abs(o),u-r/Math.abs(o)]}const pn=10,ln=10,hn=[{i:0,velocityX:.13},{i:1,velocityX:.17},{i:2,velocityX:.22}],wn=2.67,yn=2.67,vn=.4*l(pn*wn*.5,.17),xn=1e3,Mn=6e3;function Tn(n,t){return function(n,t,e){return{i:t,u:wn,m:yn,p:0,G:e?vn:-vn,width:pn,height:ln,x:e?-pn:o,y:n,velocityX:e?hn[t].velocityX:-hn[t].velocityX,X:e,R:!1}}(t,s(n.t),f())}function kn(n){const t=r(xn,Mn);n.P=setTimeout((()=>{if(n.status!==An)return;const t=i(n)-b/2-ln/2,e=Tn(n,t);n.Y.push(e),kn(n)}),t)}const Sn="GAME_NOT_STARTED",An="GAME_IN_PROGRESS",En="GAME_OVER",In="GAME_RESETTABLE",Rn=400;function Xn(i){for(let n=i.B;n>0;n-=e)i.j=Math.min(n,e),i.M+=i.j,jn(i),i.N+=1;i.V+=1,i.q-i.D>=1e3&&(i.J=i.V,i.U=i.N,i.V=0,i.N=0,i.D=i.q),function(e){(function(n){n.$.clearRect(0,0,o,n.height)})(e),function(n){M(n.$,n.images.v[n.v.i],n.v.x,n.v.y,n.v.width,n.v.height,n.v.u,n.v.m,n.v.p),n.H&&(n.$.strokeStyle=t,n.$.strokeRect(n.v.x,n.v.y,j,b))}(e),function(n){for(const e of n.Y)M(n.$,n.images.Y[e.i],e.x,e.y,e.width,e.height,e.u,e.m,e.p),n.H&&(n.$.strokeStyle=t,n.$.strokeRect(e.x,e.y,e.width,e.height))}(e),function(n){for(const e of n.I)M(n.$,n.images.K[e.i],e.x,e.y,e.width,e.height,e.u,e.m,e.p),n.H&&(n.$.strokeStyle=t,n.$.strokeRect(e.x,e.y,Q,W))}(e),function(n){n.W>0&&(n.$.fillStyle=`rgba(255, 255, 255, ${n.W})`,n.$.fillRect(0,0,o,n.height))}(e),function(e){if(e.H){const i=[performance.memory&&(performance.memory.usedJSHeapSize/1024/1024).toFixed(1)+" MB",Math.round(e.J)+" F/S",Math.round(e.U)+" U/S"].filter(Boolean).join("   ");e.$.font=n,e.$.fillStyle=t,e.$.fillText(i,8,e.height-8),e.$.strokeStyle=t,e.$.strokeRect(0,0,o,e.height)}}(e)}(i),requestAnimationFrame((n=>{i.B=n-i.q,i.q=n,Xn(i)}))}function jn(n){!function(n){const t=n.L.length>0&&n.L[0]<=n.M;n.Z&&t&&(U(n),n.L.shift())}(n),$(n),function(n){const t=n.O.filter((t=>t.F<=n.M));n.O=n.O.filter((t=>t.F>n.M)),n.I.push(...t),t.length>0&&x(n.T,n.S.nn)}(n),function(n){for(const t of n.I)t.x=h(t.x,t.velocityX,0,n.j),t.p=w(t.p,t.G,n.j)}(n),function(n){for(const t of n.Y)t.x=h(t.x,t.velocityX,0,n.j),t.p=w(t.p,t.G,n.j)}(n),function(n){if(n.status!==An)return;const t=n.Y.filter((t=>{const e=!t.R,o=d(n.v,t);return e&&o}));t.forEach((n=>n.R=!0)),n.o+=t.length,n.Y=n.Y.filter((n=>!t.includes(n))),t.length>0&&(x(n.T,n.S.tn),S(n))}(n),function(n){n.status===An?function(n){for(const t of n.I)if(d(n.v,t))return!0;return!1}(n)&&(!function(n){n.o>n.en&&(n.en=n.o,t=n.o,localStorage.setItem(T,t));var t}(n),function(n){clearTimeout(n.P)}(n),function(n){clearTimeout(n.C)}(n),function(n){clearTimeout(n.cn)}(n),function(n){n.W=1}(n),K(n),n.status=En,x(n.T,n.S.un)):n.status===En&&function(n){return 0===n.I.length&&0===n.Y.length}(n)&&(n.status=In,t=n.o,e=n.en,A().forEach(R),E().forEach(R),I().forEach(X),document.querySelector(".game-over-score").textContent=t,document.querySelector(".game-over-high-score").textContent=e);var t,e}(n),function(n){n.I=n.I.filter(p)}(n),function(n){n.Y=n.Y.filter(p)}(n),function(n){n.W>0&&(n.W-=n.j/Rn,n.W<0&&(n.W=0))}(n)}async function bn(n){await async function(n){"suspended"===n.T.state&&await n.T.resume()}(n),function(n){n.status===Sn&&function(n){return n.v.y===J(n)}(n)?(n.status=An,kn(n),gn(n),function(n){n.cn=setInterval((()=>{if(n.M-n.rn<3921)return;const t=s([0,1,2].filter((t=>t!==n.t))),e=0===n.I.length&&0===n.O.length&&0===n.Y.length;t!=n.t&&e&&(n.t=t,n.rn=n.M,S(n),x(n.T,n.S.an))}),1307)}(n),S(n)):n.status===In&&(n.status=Sn,n.v=D(),n.o=0,H(n),k())}(n),U(n),function(n){const t=n.M-n.v.h;n.status===An&&t>G*P&&(n.v.A=!0)}(n)}function _n(n,t,e){const c=n.height;n.width=o,n.height=o*e/t,function(n){n.Y.map((t=>{t.y=i(n)-b/2-ln/2}))}(n),function(n){n.I.map((t=>{t.y=sn(n)}))}(n),function(n,t){const e=i({height:t}),o=n.v.y,c=i(n);n.v.y=c-(e-o)}(n,c)}function Cn(n,t){const[e,i]=function(){const n=window.matchMedia("(min-aspect-ratio: 1/1) and (min-width: 900px)").matches?64:0;return[Math.min(window.innerWidth,window.innerHeight)-2*n,window.innerHeight-2*n]}(),c=Math.floor(e*window.devicePixelRatio),u=Math.floor(i*window.devicePixelRatio),r=c/o;n.style.width=e+"px",n.style.height=i+"px",n.width=Math.floor(c),n.height=Math.floor(u),n.getContext("2d").scale(r,r),t&&_n(t,n.width,n.height)}window.addEventListener("load",(async function(){const n=document.querySelector(".canvas"),t=n.getContext("2d"),e=new AudioContext,o={k:[],o:[]},i=[v(e,"./sfx/die.mp3").then((n=>o.un=n)),v(e,"./sfx/eat.wav").then((n=>o.tn=n)),v(e,"./sfx/jump-0.mp3").then((n=>o.k[0]=n)),v(e,"./sfx/jump-1.mp3").then((n=>o.k[1]=n)),v(e,"./sfx/jump-2.mp3").then((n=>o.k[2]=n)),v(e,"./sfx/jump-3.mp3").then((n=>o.k[3]=n)),v(e,"./sfx/jump-4.mp3").then((n=>o.k[4]=n)),v(e,"./sfx/jump-5.mp3").then((n=>o.k[5]=n)),v(e,"./sfx/score-0.wav").then((n=>o.o[0]=n)),v(e,"./sfx/score-1.wav").then((n=>o.o[1]=n)),v(e,"./sfx/score-2.wav").then((n=>o.o[2]=n)),v(e,"./sfx/score-3.wav").then((n=>o.o[3]=n)),v(e,"./sfx/shoot.wav").then((n=>o.nn=n)),v(e,"./sfx/switch.wav").then((n=>o.an=n))],c={v:[],K:[],Y:[]},u=[y("./img/player-0.png").then((n=>c.v[0]=n)),y("./img/player-1.png").then((n=>c.v[1]=n)),y("./img/player-2.png").then((n=>c.v[2]=n)),y("./img/player-3.png").then((n=>c.v[3]=n)),y("./img/snack-0.png").then((n=>c.K[0]=n)),y("./img/snack-1.png").then((n=>c.K[1]=n)),y("./img/snack-2.png").then((n=>c.K[2]=n)),y("./img/snack-0.png").then((n=>c.Y[0]=n)),y("./img/snack-1.png").then((n=>c.Y[1]=n)),y("./img/snack-2.png").then((n=>c.Y[2]=n))];await Promise.all([...i,...u]);const r=new URL(location),a="true"===r.searchParams.get("auto"),f="true"===r.searchParams.get("debug"),m=Number.parseInt(r.searchParams.get("score"))||0,g=localStorage.getItem(T)??0,d=function(n,t,e,o,i,c,u,r){return{$:n,T:t,S:e,images:o,height:0,width:0,q:0,B:0,M:0,j:0,status:Sn,o:r,en:i,t:s([0,1,2]),rn:0,v:D(),I:[],O:[],Y:[],L:[],Z:c,H:u,J:0,V:0,U:0,N:0,D:0,P:null,C:null,_:null,W:0}}(t,e,o,c,g,a,f,m);Cn(n,d),requestAnimationFrame((n=>{d.B=0,d.q=n,H(d),Xn(d)})),window.addEventListener("resize",(()=>Cn(n,d)),{passive:!0}),document.addEventListener("pointerup",function(n){async function t(){await bn(n),document.addEventListener("pointerdown",e,{passive:!0})}async function e(){await bn(n)}return t}(d),{once:!0,passive:!0}),document.addEventListener("keydown",function(n){async function t(o){" "===o.key&&(await bn(n),document.removeEventListener("keydown",t),document.addEventListener("keyup",e))}async function e(n){" "===n.key&&(document.removeEventListener("keyup",e),document.addEventListener("keydown",t))}return t}(d)),k()}))}();
